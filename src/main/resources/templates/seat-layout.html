<!--<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Select Seats - CineBook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            min-height: 100vh;
            padding: 40px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 95%;
            max-width: 1100px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px 50px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h2 {
            font-size: 2rem;
            color: #ffcc00;
            margin-bottom: 8px;
        }
        .header p {
            font-size: 1rem;
            color: #ccc;
        }

        .movie-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .movie-details { display: flex; align-items: center; gap: 20px; }
        .movie-poster { width: 90px; height: 130px; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4); }
        .movie-poster img { width: 100%; height: 100%; object-fit: cover; }

        .movie-text h3 { font-size: 1.4rem; color: #fff; margin-bottom: 5px; }
        .movie-text p { color: #ccc; font-size: 0.95rem; margin-bottom: 3px; }

        .price-section {
            text-align: right;
            color: #ffcc00;
            font-weight: bold;
        }

        .screen {
            width: 80%;
            height: 25px;
            background: linear-gradient(to bottom, #ddd, #aaa);
            margin: 40px auto;
            border-radius: 100% 100% 0 0 / 100% 100% 0 0;
            box-shadow: 0 15px 25px rgba(255, 255, 255, 0.2);
        }
        .screen-label {
            text-align: center;
            color: #ffcc00;
            font-weight: bold;
            margin-bottom: -15px;
        }

        .section {
            margin-top: 40px;
            text-align: center;
        }

        .section h3 {
            color: #ffcc00;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .seats-layout {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .seat-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .row-label {
            width: 30px;
            text-align: right;
            font-weight: bold;
            color: #ffcc00;
            margin-right: 10px;
        }

        .seat {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
        }

        .available { background: #2ecc71; }
        .booked { background: #e74c3c; cursor: not-allowed; opacity: 0.6; }
        .selected { background: #3498db; transform: scale(1.1); }

        .seat:hover:not(.booked) { transform: scale(1.05); background: #27ae60; }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 10px; }
        .legend-box { width: 20px; height: 20px; border-radius: 5px; }
        .legend-available { background: #2ecc71; }
        .legend-selected { background: #3498db; }
        .legend-booked { background: #e74c3c; }

        .summary {
            text-align: center;
            margin-top: 20px;
        }
        .summary span { color: #ffcc00; font-weight: bold; }

        .action-buttons {
            text-align: center;
            margin-top: 25px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-primary {
            background: linear-gradient(45deg, #ff512f, #dd2476);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 81, 47, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            background: linear-gradient(45deg, #ff7043, #ff4081);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }
    </style>


	<script>
	    const selectedSeats = new Set();

	    function toggleSeat(element, seatId, price) {
	        if (element.classList.contains("booked")) return; // ignore booked seats

	        element.classList.toggle("selected");

	        const form = document.querySelector("form");
	        const existingInput = document.querySelector(`input[name="seatIds"][value="${seatId}"]`);

	        if (element.classList.contains("selected")) {
	            selectedSeats.add(seatId);
	            if (!existingInput) {
	                const input = document.createElement("input");
	                input.type = "hidden";
	                input.name = "seatIds";
	                input.value = seatId;
	                form.appendChild(input);
	            }
	        } else {
	            selectedSeats.delete(seatId);
	            if (existingInput) existingInput.remove();
	        }

	        // Update total seat count and price display
	        const totalSeats = selectedSeats.size;
	        const totalPrice = totalSeats * price;
	        document.getElementById("totalSeats").textContent = totalSeats;
	        document.getElementById("totalPrice").textContent = totalPrice.toFixed(2);
	    }
	</script>

</head>
<body>
<div class="container">
    <div class="header">
        <h2 th:text="${show.movie.title}"></h2>
        <p th:text="${show.theatre.theatreName} + ' | ' + ${show.date} + ' | ' + ${show.showTime}"></p>
    </div>

    <div class="movie-info">
        <div class="movie-details">
            <div class="movie-poster">
                <img th:src="@{${movie.poster}}" alt="Movie Poster">
            </div>
            <div class="movie-text">
                <h3 th:text="${movie.title}"></h3>
                <p><i class="far fa-calendar-alt"></i> <span th:text="${show.date}"></span></p>
                <p><i class="fas fa-clock"></i> <span th:text="${show.showTime}"></span></p>
            </div>
        </div>
        <div class="price-section">
            ₹<span th:text="${show.price}"></span> / seat
        </div>
    </div>

    <div class="screen-label">SCREEN THIS WAY</div>
    <div class="screen"></div>

     ✅ Seat Layout 
    <form th:action="@{/user/confirm-booking}" method="post">
        <input type="hidden" name="showId" th:value="${show.id}">
        <input type="hidden" name="userEmail" th:value="${userEmail}"/>

        <div class="seats-layout">
            <div th:each="row : ${rowLetters}" class="seat-row">
                <div class="row-label" th:text="${row}"></div>
                <div th:each="seat : ${seats}"
                     th:if="${seat.seatNo.startsWith(row)}"
                     th:id="'seat_' + ${seat.id}"
                     th:class="'seat ' + (${seat.status} == 'booked' ? 'booked' : 'available')"
                     th:text="${seat.seatNo}"
                     th:onclick="'toggleSeat(this, ' + ${seat.id} + ', ' + ${show.price} + ')'"
                ></div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item"><div class="legend-box legend-available"></div><span>Available</span></div>
            <div class="legend-item"><div class="legend-box legend-selected"></div><span>Selected</span></div>
            <div class="legend-item"><div class="legend-box legend-booked"></div><span>Booked</span></div>
        </div>

        <div class="summary">
            Seats Selected: <span id="totalSeats">0</span> |
            Total Price: ₹<span id="totalPrice">0.00</span>
        </div>

        <div class="action-buttons">
            <a href="/user/movies" class="btn btn-secondary">← Back</a>
            <button type="submit" class="btn btn-primary">Confirm Booking</button>
        </div>
    </form>
</div>
</body>
</html>

-->


































<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Select Seats - CineBook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            min-height: 100vh;
            padding: 40px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 95%;
            max-width: 1100px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px 50px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h2 {
            font-size: 2rem;
            color: #ffcc00;
            margin-bottom: 8px;
        }
        .header p {
            font-size: 1rem;
            color: #ccc;
        }

        .movie-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .movie-details { display: flex; align-items: center; gap: 20px; }
        .movie-poster { width: 90px; height: 130px; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4); }
        .movie-poster img { width: 100%; height: 100%; object-fit: cover; }

        .movie-text h3 { font-size: 1.4rem; color: #fff; margin-bottom: 5px; }
        .movie-text p { color: #ccc; font-size: 0.95rem; margin-bottom: 3px; }

        .price-section {
            text-align: right;
            color: #ffcc00;
            font-weight: bold;
        }

        .screen {
            width: 80%;
            height: 25px;
            background: linear-gradient(to bottom, #ddd, #aaa);
            margin: 40px auto;
            border-radius: 100% 100% 0 0 / 100% 100% 0 0;
            box-shadow: 0 15px 25px rgba(255, 255, 255, 0.2);
        }
        .screen-label {
            text-align: center;
            color: #ffcc00;
            font-weight: bold;
            margin-bottom: -15px;
        }

        .section {
            margin-top: 40px;
            text-align: center;
        }

        .section h3 {
            color: #ffcc00;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .seats-layout {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .seat-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .row-label {
            width: 30px;
            text-align: right;
            font-weight: bold;
            color: #ffcc00;
            margin-right: 10px;
        }

        .seat {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
        }

        .available { background: #2ecc71; }
        .booked { background: #e74c3c; cursor: not-allowed; opacity: 0.7; }
        .locked { background: #f1c40f; cursor: not-allowed; opacity: 0.8; }
        .selected { background: #3498db; transform: scale(1.1); }

        .seat:hover:not(.booked):not(.locked) { transform: scale(1.05); background: #27ae60; }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 10px; }
        .legend-box { width: 20px; height: 20px; border-radius: 5px; }
        .legend-available { background: #2ecc71; }
        .legend-selected { background: #3498db; }
        .legend-booked { background: #e74c3c; }
        .legend-locked { background: #f1c40f; }

        .summary {
            text-align: center;
            margin-top: 20px;
        }
        .summary span { color: #ffcc00; font-weight: bold; }

        .action-buttons {
            text-align: center;
            margin-top: 25px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-primary {
            background: linear-gradient(45deg, #ff512f, #dd2476);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 81, 47, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            background: linear-gradient(45deg, #ff7043, #ff4081);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }
    </style>

    <script>
        const selectedSeats = new Set();

        function toggleSeat(element, seatId, price) {
            if (element.classList.contains("booked") || element.classList.contains("locked")) return;

            element.classList.toggle("selected");

            const form = document.querySelector("form");
            const existingInput = document.querySelector(`input[name="seatIds"][value="${seatId}"]`);

            if (element.classList.contains("selected")) {
                selectedSeats.add(seatId);
                if (!existingInput) {
                    const input = document.createElement("input");
                    input.type = "hidden";
                    input.name = "seatIds";
                    input.value = seatId;
                    form.appendChild(input);
                }
            } else {
                selectedSeats.delete(seatId);
                if (existingInput) existingInput.remove();
            }

            const totalSeats = selectedSeats.size;
            const totalPrice = totalSeats * price;
            document.getElementById("totalSeats").textContent = totalSeats;
            document.getElementById("totalPrice").textContent = totalPrice.toFixed(2);
        }

        // Real-time refresh every 5 seconds
        function refreshSeatStatus() {
            fetch(window.location.href, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
                .then(res => res.text())
                .then(html => {
                    const parser = new DOMParser();
                    const newDoc = parser.parseFromString(html, 'text/html');
                    const newSeats = newDoc.querySelectorAll('.seat');
                    newSeats.forEach(seat => {
                        const currentSeat = document.getElementById(seat.id);
                        if (currentSeat) currentSeat.className = seat.className;
                    });
                })
                .catch(err => console.error('Error refreshing seats:', err));
        }
        setInterval(refreshSeatStatus, 5000);
    </script>
</head>

<body>
<div class="container">
    <div class="header">
        <h2 th:text="${show.movie.title}"></h2>
        <p th:text="${show.theatre.theatreName} + ' | ' + ${show.date} + ' | ' + ${show.showTime}"></p>
    </div>

    <div class="movie-info">
        <div class="movie-details">
            <div class="movie-poster">
                <img th:src="@{${movie.poster}}" alt="Movie Poster">
            </div>
            <div class="movie-text">
                <h3 th:text="${movie.title}"></h3>
                <p><i class="far fa-calendar-alt"></i> <span th:text="${show.date}"></span></p>
                <p><i class="fas fa-clock"></i> <span th:text="${show.showTime}"></span></p>
            </div>
        </div>
        <div class="price-section">
            ₹<span th:text="${show.price}"></span> / seat
        </div>
    </div>

    <div class="screen-label">SCREEN THIS WAY</div>
    <div class="screen"></div>

    <form th:action="@{/user/confirm-booking}" method="post">
        <input type="hidden" name="showId" th:value="${show.id}">
        <input type="hidden" name="userEmail" th:value="${userEmail}"/>

        <div class="seats-layout">
            <div th:each="row : ${rowLetters}" class="seat-row">
                <div class="row-label" th:text="${row}"></div>
                <div th:each="seat : ${seats}"
                     th:if="${seat.seatNo.startsWith(row)}"
                     th:id="'seat_' + ${seat.id}"
                     th:class="'seat ' + 
                        (${seat.status.toLowerCase() == 'booked' ? 'booked' : 
                         (seat.status.toLowerCase() == 'locked' ? 'locked' : 'available')})"
                     th:text="${seat.seatNo}"
                     th:onclick="'toggleSeat(this, ' + ${seat.id} + ', ' + ${show.price} + ')'">
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item"><div class="legend-box legend-available"></div><span>Available</span></div>
            <div class="legend-item"><div class="legend-box legend-selected"></div><span>Selected</span></div>
            <div class="legend-item"><div class="legend-box legend-booked"></div><span>Booked</span></div>
            <div class="legend-item"><div class="legend-box legend-locked"></div><span>Locked</span></div>
        </div>

        <div class="summary">
            Seats Selected: <span id="totalSeats">0</span> |
            Total Price: ₹<span id="totalPrice">0.00</span>
        </div>

        <div class="action-buttons">
            <a href="/user/movies" class="btn btn-secondary">← Back</a>
            <button type="submit" class="btn btn-primary">Confirm Booking</button>
        </div>
    </form>
</div>
</body>
</html>
